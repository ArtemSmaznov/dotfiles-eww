(defwidget separator []
  (box :class "status-bar-widget separator"
       :orientation "h"
       :halign "center"
       "|"))

(defwidget logo []
           (eventbox :cursor "pointer"
                     :onclick "wofi --show drun"
                     (image :class "status-bar-widget logo"
                            :path "/home/artem/.local/share/icons/Papirus-Dark/64x64/apps/distributor-logo-archlinux.svg"
                            :image-height "30")))

(defwidget time []
  (box :class "widget time"
       :orientation "h"
       :space-evenly false
    {time}))

(defwidget workspaces []
           (box :class "bar-widget bar-widget-workspaces"
                :space-evenly false
                :spacing status-bar-widget-spacing

                (for workspace in listen_workspaces
                     (eventbox :onclick "hyprctl dispatch workspace ${workspace.id}"
                               (box :class "workspace-entry ${workspace.windows > 0 ? "occupied" : "empty"} ${workspace.monitor == 0 ? "monitor_0": ""} ${workspace.monitor == 1 ? "monitor_1": ""}"
                                    (label :text { workspace.name == 1 ? "globe"        :
                                                   workspace.name == 2 ? "gamepad"      :
                                                   workspace.name == 3 ? "keyboard"     :
                                                   workspace.name == 4 ? "folder"       :
                                                   workspace.name == 5 ? "headphones"   :
                                                   workspace.name == 6 ? "camera"       :
                                                   workspace.name == 7 ? "comment"      :
                                                   workspace.name == 8 ? "server"       :
                                                   workspace.name == 9 ? "chart-simple" :
                                                                          workspace.name }))))))



(defwidget key-chord []
           (revealer :transition "slideleft"
                     :duration revealer-duration
                     :reveal { wm-key-chord != "" }
                     (label :class "widget key-chord"
                            :text wm-key-chord)))

(defwidget window-title []
  (label :limit-width 40
         :text window-title))

(defwidget player []
           (eventbox :onclick "eww open --toggle status-panel"
                     :cursor "pointer"
                     (box :class "widget player"
                          :orientation "h"
                          :space-evenly false
                          :spacing status-bar-icon-spacing
                          :halign "center"

                          (icon :icon { player-state == "stopped" ? "stop" :
                                        player-state == "playing" ? "play" :
                                                                    "pause" })
                          (label :text "·")

                          (revealer :transition "slideright"
                                    :duration revealer-duration
                                    :reveal { player-artist != "" }
                                    (box :orientation "h"
                                         :space-evenly false
                                         :spacing status-bar-icon-spacing
                                         (label :class "player-artist"
                                                :limit-width 50
                                                :text player-artist)
                                         (label :text "-")))

                          (label :class "player-title"
                                 :limit-width 50
                                 :text player-title)

                          (revealer :transition "slideright"
                                    :duration revealer-duration
                                    :reveal { player-name == "mpd" }
                                    (box :orientation "h"
                                         :space-evenly false
                                         :spacing status-bar-icon-spacing
                                         (label :text "·")
                                         (label :class "music-flags"
                                                :text music-flags)))

                          (label :text "·")
                          (label :class "player-volume"
                                 :text "${replace(round(player-volume, 2), '0.', '')}%"))))

(defwidget sys-tray []
  (box :orientation "h"
       :visible { trayer-width != 0 ? true : false }
       :space-evenly false
       (separator)
       (box :orientation "h"
            :width trayer-width)))

(defwidget kbd []
  (box :orientation "h"
       :space-evenly false
       :class "widget language"
       (flag :lang kbd)))

(defwidget flag [?lang]
  (image :image-height "18"
         :path "/usr/share/iso-flag-png/${lang}.png"))

(defwidget battery []
  (revealer :transition "slideright"
            :duration revealer-duration
            :reveal {present == "yes" ? true : false}
            (box :class "widget colored 7 volume"
                (slider :icon "gamepad"
                    :value charge
                    :onchange ""
                    ))))

(defwidget updates []
           (eventbox :onclick "eww open --toggle updates-list"
                     :cursor "pointer"
                     (box :class { updates ==   0  ? "status-widget colored 6 state-good"  :
                                   updates ==  69  ? "status-widget colored 6 red"         :
                                   updates == 101  ? "status-widget colored 6 orange"      :
                                   updates == 220  ? "status-widget colored 6 yellow"      :
                                   updates == 360  ? "status-widget colored 6 blue"        :
                                   updates == 404  ? "status-widget colored 6 yellow"      :
                                   updates == 420  ? "status-widget colored 6 green"       :
                                   updates == 555  ? "status-widget colored 6 green"       :
                                   updates == 1001 ? "status-widget colored 6 purple"      :
                                   updates == year ? "status-widget colored 6 special"     :
                                                     "status-widget colored 6"             }

                          :orientation "h"
                          :space-evenly false
                          (icon :icon { updates ==   0  ? "check"    :
                                        updates ==  69  ? "heart"    :
                                        updates == 101  ? "book"     :
                                        updates == 220  ? "bolt"     :
                                        updates == 360  ? "globe"    :
                                        updates == 404  ? "warning"  :
                                        updates == 420  ? "cannabis" :
                                        updates == 555  ? "dollar"   :
                                        updates == 1001 ? "moon"     :
                                        updates == year ? "calendar" :
                                                          "bell" })

                          (revealer :class { updates ==  69  ? "updates"               :
                                             updates == 101  ? "updates"               :
                                             updates == 220  ? "updates"               :
                                             updates == 360  ? "updates"               :
                                             updates == 404  ? "updates"               :
                                             updates == 420  ? "updates"               :
                                             updates == 555  ? "updates"               :
                                             updates == 1001 ? "updates"               :
                                             updates == year ? "updates"               :
                                             updates >= 900  ? "updates state-urgent"  :
                                             updates >= 400  ? "updates state-warning" :
                                                               "updates" }
                                    :transition "slideright"
                                    :reveal { updates > 0 }
                                    :duration revealer-duration
                                    updates )

                          (revealer :class "yellow update-flags"
                                    :transition "slideright"
                                    :reveal { update-flags != "" }
                                    :duration revealer-duration
                                    update-flags))))

(defwidget network []
           (box :class "status-widget colored 5 network"
                :space-evenly false
                :spacing status-bar-icon-spacing

                (icon :icon "ethernet")
                (graph :min 0
                       :width status-bar-graph-width
                       :class "graph net-down"
                       :time-range {graph_net_time_range}
                       :dynamic false
                       :max {graph_net_max_speed_bytes}
                       :thickness 2
                       :line-style "round"
                       :value {EWW_NET.eno1.NET_DOWN})
                ;; :value {EWW_NET[interface].NET_DOWN})
                (icon :icon "⇵")
                (graph :min 0
                       :width status-bar-graph-width
                       :class "graph net-up"
                       :time-range {graph_net_time_range}
                       :dynamic false
                       :max {graph_net_max_speed_bytes}
                       :thickness 2
                       :value {EWW_NET.eno1.NET_UP})))
;; :value {EWW_NET[interface].NET_UP})))

(defwidget ram []
           (box :class "status-widget colored 4 volume"
                (slider :icon "memory"
                        :value {EWW_RAM.used_mem_perc}
                        :onchange "")))

(defwidget cpu []
           (box :class "status-widget colored 3 volume"
                (slider :icon "microchip"
                        :value {EWW_CPU.avg}
                        :onchange "")))

(defwidget cpu-thermal []
           (box :class "status-widget colored 2 volume"
                :spacing status-bar-icon-spacing
                (icon :icon "")
                { round(EWW_TEMPS.K10TEMP_TCTL, 0) }
                "°C"))

(defwidget volume []
    (box :class "status-widget colored 1 volume"
        (slider :icon { mute   == "on" ? "volume-xmark" :
                        volume ==  0   ? "volume-off"   :
                        volume <= 40   ? "volume-low"   :
                                        "volume-high"  }
                :value volume
                :onchange "amixer -D pulse sset Master {}%"
                )))

(defwidget disk_usage [?icon disk]
    (slider :icon icon
            :value {round((1 - (EWW_DISK[disk].free / EWW_DISK[disk].total)) * 100, 0)}
            :onchange ""))

(defwidget uptime []
  (box :orientation "h"
       :space-evenly false
       :spacing status-bar-icon-spacing
       (icon :icon "circle-arrow-up")
       uptime))

(defwidget date []
  (eventbox :onclick "eww open --toggle --screen $(/home/artem/.config/hypr/scripts/get-current-monitor.sh id) calendar-window"
            :cursor "pointer"
            (box :class "widget date"
                 :orientation "h"
                 :space-evenly false
                 :halign "center"
                 :spacing status-bar-icon-spacing

                 (icon :icon { matches(date, "20 apr") ? "cannabis" :
                               matches(date, "25 dec") ? "candy-cane" :
                               matches(date, "31 dec") ? "champagne-glasses" :
                                                         "calendar" })
                 {date})))

(defwidget profile []
           (eventbox :class "status-bar-widget profile"
                     :onclick "eww open --toggle powermenu-panel"
                     :cursor "pointer"

                     (box :class "profile-face"
                          :width status-bar-size
                          :height status-bar-size
                          :style "background-image: url('${profile-face}');")))

(defwidget icon [?icon]
  (label :class "icon"
         :text icon))

(defwidget slider [icon value onchange]
           (box :class "slider status-widget"
                :orientation "h"
                :space-evenly false
                :spacing status-bar-icon-spacing

                (icon :icon icon)
                (scale :min 0
                       :max 100
                       :active {onchange != ""}
                       :value value
                       :onchange onchange)))

(defwidget circular [icon value]
  (box :orientation "h"
       :class "progress status-widget"
       :space-evenly false
       (icon :icon icon)
       (circular-progress :value value
                          :start-at 0
                          :thickness 7
                          :clockwise true
                          )))

(defwindow confirmation-window
  :monitor 0
  :geometry (geometry :x "0%"
                      :y "0%"
                      :width "300px"
                      :height "100px"
                      :anchor "center")
  :windowtype "dialog"
  :stacking "fg"
  :wm-ignore true
  (confirmation-dialog)
  )

(defvar confirmation-message "")
(defvar yes-command "")
(defvar dismiss-command "eww close confirmation-window")

(defwidget confirmation-dialog []
  (box :orientation "v"
       confirmation-message
       (box :orientation "h"
            (button :onclick "${yes-command} & ${dismiss-command}"
                    "yes")
            (button :onclick dismiss-command
                    "no")
       )))
